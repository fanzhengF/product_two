<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>订单明细-{$site.SITE_INFO.name}</title>
<php> $addCss=""; $addJs=""; $currentNav ='订单 > 订单明细'; </php>
<include file="Common:intoHead" />
<script language="javascript" type="text/javascript" src="__PUBLIC__/Js/Admin/calender.js"></script>
</head>
<body style="overflow-x:hidden;">
    <div class="wrap">
        <include file="Common:head" />

        <div class="mainBody" style="overflow:hidden">
            <include file="Common:left" />
            <div id="Right" style="float: left; width: 780px;">

                <div class="Item hr">
                    <div class="current">订单明细</div>
                </div>
                <form action="" method="get" id="search">
                    <div>
                        <if condition="$access.supplier eq 1">
                            <b>供应商&nbsp;</b>
                            <select id="supplier_id" name="supplier_id" style="width: 80px;" onchange="javascript:getCompany(this.value)">
                                <option value="" >请选择</option>
                                <notempty  name="data.supplier">
                                    <foreach name="data.supplier" item="vo">
                                        <option value="{$key}" <if condition="$Think.get.supplier_id eq $key"> selected ="selected" </if>>{$vo}</option>
                                    </foreach>
                                </notempty >
                            </select>
                        </if>

                        <if condition="$access.company eq 1">
                            <b>分公司&nbsp;</b>
                            <select id="company_id" name="company_id" style="width: 80px;" onchange="javascript:getShop(this.value)">
                                <option value="" >请选择</option>
                                <notempty  name="data.company">
                                    <foreach name="data.company" item="vo">
                                        <option value="{$key}" <if condition="$Think.get.company_id eq $key"> selected ="selected" </if>>{$vo}</option>
                                    </foreach>
                                </notempty >
                            </select>
                        </if>

                        <if condition="$access.shop eq 1">
                            <b>实体店&nbsp;</b>
                            <select id="shop_id" name="shop_id" style="width: 80px;">
                                <option value="" >请选择</option>
                                <notempty  name="data.shop">
                                    <foreach name="data.shop" item="vo">
                                        <option value="{$key}" <if condition="$Think.get.shop_id eq $key"> selected ="selected" </if>>{$vo}</option>
                                    </foreach>
                                </notempty >
                            </select>
                        </if>

                        <b>订单号&nbsp;</b>
                        <input style="width: 80px" class="input" type="text" name="trade_id" value="{$Think.get.trade_id}" />

                        <b>支付单号&nbsp;</b>
                        <input style="width: 80px" class="input" type="text" name="pay_id" value="{$Think.get.pay_id}" />

                        <b>客户姓名&nbsp;</b>
                        <input style="width: 80px" class="input" type="text" name="user_name" value="{$Think.get.user_name}" />

                        <b>客户手机号&nbsp;</b>
                        <input style="width: 80px" class="input" type="text" name="user_tel" value="{$Think.get.user_tel}" />

                        </br></br>

                        <b>支付渠道&nbsp;</b>
                        <select id="pay_type_id" name="pay_type_id">
                            <option value="" >请选择</option>
                            <foreach name="pay_types" item="vo">
                                <option value="{$key}" <if condition="$Think.get.pay_type_id eq $key"> selected ="selected" </if>>{$vo}</option>
                            </foreach>
                        </select>

                        <b>交易时间&nbsp;</b>
                        <input placeholder="开始" id="start_time" class="input" type="text" name="start_time" readonly="readonly" onclick="new Calendar().show(this);" value="{$Think.get.start_time}">

                        <b>交易时间&nbsp;</b>
                        <input placeholder="结束" id="end_time" class="input" type="text" name="end_time" readonly="readonly" onclick="new Calendar().show(this);" value="{$Think.get.end_time}">

                        <input type="submit" id="check_btn" value="搜索" class="btn quickSubmit">
                    </div>
                </form>

                <table width="100%" border="0" cellspacing="0" cellpadding="0"
                    class="tab">
                    <thead>
                        <tr>
                            <td>订单号</td>
                            <td>供应商</td>
                            <td>分公司</td>
                            <td>实体店</td>
                            <td>支付单号</td>
                            <td>客户姓名</td>
                            <td>客户手机号</td>
                            <td>消费总额</td>
                            <td>实收金额</td>
                            <empty name="unview">
                                <td>平台扣点比率</td>
                                <td>平台结算金额</td>
                                <td>供应商结算金额</td>
                            </empty >
                            <td>支付渠道</td>
                            <td>交易时间</td>
                        </tr>

                    </thead>
                    <volist name="list" id="vo">
                    <tr align="center" id="">
                        <td>{$vo.trade_id}</td>
                        <td>{$vo.supplier_name}</td>
                        <td>{$vo.company_name}</td>
                        <td>{$vo.shop_name}</td>
                        <td>{$vo.pay_id}</td>
                        <td>{$vo.user_name}</td>
                        <td>{$vo.user_tel}</td>
                        <td>{$vo.total_price}</td>
                        <td>{$vo.really_price}</td>
                        <empty name="unview">
                            <td>{$vo.platform_rate}</td>
                            <td>{$vo.platform_price}</td>
                            <td>{$vo.supplier_price}</td>
                        </empty >
                        <td>{$vo.pay_type_name}</td>
                        <td>{$vo.pay_time|date='Y-m-d H:i:s',###}</td>
                    </tr>
                    </volist>

                    <tr >
                        <td class="fy" colspan="15">
                            <ul>{$page}</ul>
                        </td>
                    </tr>

                </table>

            </div>
        </div>
    </div>
    <div class="clear"></div>
    <include file="Common:foot" />
    <script type="text/javascript">
        var supplier_id = <?php echo intval($_GET['supplier_id'])?>;
        var company_id  = <?php echo intval($_GET['company_id'])?>;
        var shop_id     = <?php echo intval($_GET['shop_id'])?>;
        if(supplier_id >0){
            getCompany(supplier_id);
        }
        if(company_id >0){
            getShop(company_id);
        }

        function getCompany(n){
            $.get("/Admin/Access/getOwnerCompany?status_id=2&role_id=3&supplier_id="+n,function(data){
                if(data.status){
                    $("#company_id").empty();
                    tmpDom = '<option value="">请选择</option>';
                    if(data.data.list){
                        $.each(data.data.list,function(n,value){
                                if(company_id>0 && value.id==company_id){
                                    tmpDom += '<option value="'+value.id+'" selected >'+value.business_name+'</option>';
                                }else{
                                    tmpDom += '<option value="'+value.id+'">'+value.business_name+'</option>';
                                }
                            }
                        );
                    }
                    $("#company_id").append(tmpDom);
                }else{

                }

            },"json");
        }
        function getShop(n){
            $.get("/Admin/Access/getOwnerShop?status_id=2&role_id=4&company_id="+n,function(data){
                if(data.status){
                    $("#shop_id").empty();
                    tmpDom = '<option value="">请选择</option>';
                    if(data.data.list){
                        $.each(data.data.list,function(n,value){
                                if(shop_id>0 && value.id==shop_id){
                                    tmpDom += '<option value="'+value.id+'" selected>'+value.business_name+'</option>';
                                }else{
                                    tmpDom += '<option value="'+value.id+'">'+value.business_name+'</option>';
                                }
                            }
                        );
                    }
                    $("#shop_id").append(tmpDom);
                }else{

                }

            },"json");
        }

        //获取订单
        $.ajax({
            url:"http://shg.jiaju.com/Cron/ShopOrder",
            async:true,
            cache:false,
            type:"GET",
            dataType:"json",
        });

    </script>
</body>
</html>
